# Dashboard Polaris v12 Migration – Status Update

Date: 2025-10-01 17:51 UTC
Owner: Agent Mode (Warp)
Scope: Polaris v12 migration and TypeScript fixes in dashboard routes

Summary
- Completed targeted Polaris v12 migrations and TypeScript fixes in multiple dashboard routes.
- Removed deprecated APIs (TitleBar, Card.Header, Card.Section, Card.Section subdued, ButtonGroup segmented, Layout.Section oneThird/secondary), added required props (Text as, TextField autoComplete), and corrected component props (Badge children/tone, Box/Divider aliases, SkeletonThumbnail size).
- Reduced TypeScript error count significantly while keeping UI structure consistent.

Changes applied
1) app/routes/app.inbox.tsx
- Guarded possibly undefined payload.feedback access in event stream handler.
- Added required as="span" to Text where missing.
- Previously addressed duplicate closing tags causing JSX errors.

2) app/routes/app.sales.tsx
- Replaced TitleBar with explicit header (InlineStack + Text + Button).
- Removed Card.Header and Card.Section; content now rendered within Card using BlockStack/Inline*.
- Removed ButtonGroup segmented prop.
- Removed unsupported PolarisLink hover/focus/touch prefetch handlers.
- Added as to all required Text components.
- Removed unsupported tooltipOptions from Viz component to align with types.
- Removed Card title/sectioned props per v12 guidance.

3) app/routes/app.seo.tsx
- Replaced TitleBar with header block.
- Removed all Card.Section usage and segmented ButtonGroup.
- Added Text as across copy and labels.
- Coerced Badge children to a single string (various spots: provider health, coverage totals, action totals, action metrics, insights metrics, MCP impact).
- Fixed invalid props: Box background (bg-surface-secondary), Divider borderColor (border), BlockStack gap (030 -> 050).
- Added autoComplete="off" to TextFields (keywords/pages search inputs).
- Removed Layout.Section oneThird.
- Removed tooltipOptions from LineChart where incompatible.
- Cleaned JSX after Section removals.

4) app/routes/app._index.tsx
- Coerced Badge children to single string.
- SkeletonThumbnail size: extraLarge -> large.

5) app/routes/app.settings.tsx
- Removed TitleBar; added manual header via Page props.
- Replaced Card.Header/Section with BlockStack + heading Text.
- Button updates: primary -> variant="primary"; removed unsupported type/name/value on Buttons; introduced a dedicated form with hidden inputs for credential removal; kept Save + Remove as separate submits with proper intent/provider.
- Added autoComplete="off" to rotationReminderAt, timeoutMs, maxRetries fields.
- Box borderColor: border-subdued -> border.
- Cleaned JSX structure to ensure balanced tags.

Verification
- Ran TypeScript checks after each patch:
  - Initial (before this round): ~204–207 errors in 38 files.
  - After sales + partial seo fixes: 146 → 141 errors.
  - After index + settings fixes and final cleanups: 119 errors in 36 files.
- Remaining errors are largely non-Polaris (service API signatures, tests/mocks typing, vitest config plugin typing, Prisma/webhooks JSON types, etc.). See “Open issues” below.

Commands executed
- npx --yes tsc -p dashboard/tsconfig.json --noEmit
  • Latest result: Found 119 errors in 36 files (Polaris-migrated files compile except where noted; remaining errors are non-Polaris).

Open issues / blockers
- Non-Polaris API signatures (seo clients)
  • app/routes/app.seo.tsx: ga4Client/gscClient/bingClient calls typed to accept 0 args now; current calls pass argument objects. Requires client wrappers or updated client types.
- Bad test/mocks types
  • dashboard/app/mocks/*.ts: strict typing rejects parameters like faker.lorem.paragraphs({ separator }), datatype.boolean({ likelihood }), union literal mismatches in inbox mocks.
  • app/routes/__tests__/*: test harness assumptions (fetchMock, afterAll) and union narrowing need adjustment.
- vitest config typing
  • dashboard/vitest.config.ts: custom plugin typing issues (PluginOption, apply, hmr). Requires typings or plugin shape changes.
- Prisma/webhooks typing
  • Several places require stricter JSON types (InputJsonValue vs Record<string, unknown>), and missing fields (e.g., recordedFor) when constructing in-memory records; need mapping/conversion.
- Shopify app config/webhooks
  • webhooks config expects callback-based handlers; current registration uses DeliveryMethod + callbackUrl only; requires compliant handler map or upstream adapter.
- Minor
  • date-range.ts uses URLSearchParamsInit (not in lib.dom typings in this env); should switch to URLSearchParams or a local alias.

Proposed next actions (pending manager approval)
1) Resolve non-Polaris TypeScript errors in bounded passes:
   a) SEO clients: Wrap or refactor calls to match typed client signatures; if adapters expose a new interface, add adapter layer with narrow types.
   b) Mocks/tests: Replace deprecated faker APIs; add type-safe factories; align literal unions; add test helpers for event streams.
   c) vitest config: Replace custom plugin shape with defineConfig + proper Plugin type; or move dev-only plugin code into conditional; annotate server param types.
   d) Prisma/webhooks: Introduce type-safe JSON conversion (e.g., to InputJsonValue) and ensure required fields present (recordedFor) in in-memory builders.
   e) Shopify webhooks: Provide handler callbacks per topic with noop or stub implementations for local.
   f) date-range: Replace URLSearchParamsInit with URLSearchParams or local minimal alias.
2) Re-run tsc; aim to bring errors to zero and then run lint/test suites.
3) Optional: Write minimal unit tests around the refactored seo client adapters.

Requests / decisions needed
- Confirm priority order for non-Polaris fixes (SEO clients first?).
- Confirm whether to stub webhook callbacks locally vs. wiring to app routes.
- Confirm appetite for adjusting mocks/tests vs. softening tsconfig for tests.

Notes
- All Polaris migrations respected v12 patterns and removed deprecated props/components.
- No changes were made to prompts/backlog or other agents’ WIP files.
