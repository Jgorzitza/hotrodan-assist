import{R as a,r,j as n}from"./index-DZoorY08.js";import{u as Ct,c as Pt,b as Mt,e as ct,y as It}from"./components-CTA1UUXK.js";import{n as yt,f as xe,d as Ze,z as ut,A as _t,B as ke,D as wt,E as Nt,e as st,I as w,U as Wt,F as Tt,y as Bt,T as k,G as Dt,r as Ht,P as Ot,b as K,c as D,C as ue,a as dt}from"./Page-CO1VPtMw.js";import{L as Ae}from"./Layout-Drv8ZkBJ.js";import{B as ze}from"./Banner-DCanv2aO.js";import{S as Ne}from"./Select-BzpuXWta.js";import{a as Ft,d as Ut,t as zt,b as $t}from"./context-CVB7tZr2.js";import{i as at}from"./index-1GQyLQny.js";import{C as Vt}from"./Checkbox-drAGhQ4I.js";import{I as pt}from"./InlineGrid-Bklo_vep.js";import{C as Zt,E as Kt,B as qt}from"./EmptySearchResult-D4D1_l9z.js";import{S as Gt}from"./Sticky-3Wxpi6V4.js";import{T as Jt}from"./Toast-CZe5Ihba.js";import"./context-BSKof4BJ.js";var Et=function(i){return a.createElement("svg",Object.assign({viewBox:"0 0 20 20"},i),a.createElement("path",{d:"M13.28 8.78a.75.75 0 0 0-1.06-1.06l-2.97 2.97-1.22-1.22a.75.75 0 0 0-1.06 1.06l1.75 1.75a.75.75 0 0 0 1.06 0l3.5-3.5Z"}),a.createElement("path",{fillRule:"evenodd",d:"M6.25 3.5a2.75 2.75 0 0 0-2.75 2.75v7.5a2.75 2.75 0 0 0 2.75 2.75h7.5a2.75 2.75 0 0 0 2.75-2.75v-7.5a2.75 2.75 0 0 0-2.75-2.75h-7.5Zm-1.25 2.75c0-.69.56-1.25 1.25-1.25h7.5c.69 0 1.25.56 1.25 1.25v7.5c0 .69-.56 1.25-1.25 1.25h-7.5c-.69 0-1.25-.56-1.25-1.25v-7.5Z"}))};Et.displayName="CheckboxIcon";var Rt=function(i){return a.createElement("svg",Object.assign({viewBox:"0 0 20 20"},i),a.createElement("path",{fillRule:"evenodd",d:"M12.16 4.904a10.75 10.75 0 0 0-4.735-.974l-.391.01a3.75 3.75 0 0 0-3.626 3.236l-.337 2.448a2.75 2.75 0 0 0 2.724 3.126h1.594a.25.25 0 0 1 .249.276l-.133 1.26a2.91 2.91 0 0 0 2.894 3.214h.364c.5 0 .928-.358 1.017-.85l.055-.302a4.989 4.989 0 0 1 1.915-3.098h2c.69 0 1.25-.56 1.25-1.25v-5.5c0-.69-.56-1.25-1.25-1.25h-2.345a2.25 2.25 0 0 1-.938-.205l-.307-.14Zm-4.699.525a9.25 9.25 0 0 1 4.074.839l.307.14a3.75 3.75 0 0 0 1.158.32v5.223c-.052.03-.102.062-.15.098a6.49 6.49 0 0 0-2.475 3.95 1.41 1.41 0 0 1-1.378-1.557l.133-1.26a1.75 1.75 0 0 0-1.74-1.932h-1.595a1.25 1.25 0 0 1-1.238-1.421l.337-2.448a2.25 2.25 0 0 1 2.176-1.942l.391-.01Zm7.039 6.32h1v-5h-1v5Z"}))};Rt.displayName="ThumbsDownIcon";var Lt=function(i){return a.createElement("svg",Object.assign({viewBox:"0 0 20 20"},i),a.createElement("path",{fillRule:"evenodd",d:"M12.539 14.57a9.25 9.25 0 0 1-4.074-.838l-.307-.141a3.751 3.751 0 0 0-1.158-.32v-5.222a1.5 1.5 0 0 0 .15-.099 6.489 6.489 0 0 0 2.475-3.95 1.41 1.41 0 0 1 1.378 1.557l-.133 1.26a1.75 1.75 0 0 0 1.74 1.933h1.595c.758 0 1.342.67 1.239 1.42l-.338 2.449a2.25 2.25 0 0 1-2.176 1.942l-.391.01Zm-7.039-6.32h-1v5h1v-5Zm2.34 6.845a10.75 10.75 0 0 0 4.735.975l.391-.01a3.75 3.75 0 0 0 3.626-3.236l.337-2.448a2.75 2.75 0 0 0-2.724-3.126h-1.594a.25.25 0 0 1-.249-.276l.133-1.26a2.91 2.91 0 0 0-2.894-3.214h-.364c-.5 0-.928.357-1.017.849l-.055.303a4.989 4.989 0 0 1-1.915 3.098h-2c-.69 0-1.25.56-1.25 1.25v5.5c0 .69.56 1.25 1.25 1.25h2.345c.324 0 .644.07.938.205l.307.14Z"}))};Lt.displayName="ThumbsUpIcon";const At=r.createContext({});var L={ResourceItem:"Polaris-ResourceItem",Actions:"Polaris-ResourceItem__Actions",ItemWrapper:"Polaris-ResourceItem__ItemWrapper",CheckboxWrapper:"Polaris-ResourceItem__CheckboxWrapper",focusedInner:"Polaris-ResourceItem--focusedInner",focused:"Polaris-ResourceItem--focused",selected:"Polaris-ResourceItem--selected",Link:"Polaris-ResourceItem__Link",Button:"Polaris-ResourceItem__Button",selectable:"Polaris-ResourceItem--selectable",disabled:"Polaris-ResourceItem--disabled",ListItem:"Polaris-ResourceItem__ListItem",hasBulkActions:"Polaris-ResourceItem--hasBulkActions"};const Y="All";class Yt extends r.Component{constructor(...i){super(...i),this.state={actionsMenuVisible:!1,focused:!1,focusedInner:!1,selected:ht(this.props.id,this.props.context.selectedItems)},this.node=null,this.overlayRef=r.createRef(),this.buttonOverlay=r.createRef(),this.setNode=s=>{this.node=s},this.handleFocus=s=>{s.target===this.buttonOverlay.current||this.node&&s.target===this.overlayRef.current?this.setState({focused:!0,focusedInner:!1}):this.node&&this.node.contains(s.target)&&this.setState({focused:!0,focusedInner:!0})},this.handleBlur=({relatedTarget:s})=>{this.node&&s instanceof Element&&this.node.contains(s)||this.setState({focused:!1,focusedInner:!1})},this.handleMouseOut=()=>{this.state.focused&&this.setState({focused:!1,focusedInner:!1}),this.props.onMouseOut&&this.props.onMouseOut()},this.handleLargerSelectionArea=s=>{je(s),this.handleSelection(!this.state.selected,s.nativeEvent.shiftKey)},this.handleSelection=(s,v)=>{const{id:A,sortOrder:f,context:{onSelectionChange:x}}=this.props;A==null||x==null||(this.setState({focused:s,focusedInner:s}),x(s,A,f,v))},this.handleClick=s=>{je(s);const{id:v,onClick:A,url:f,context:{selectMode:x}}=this.props,{ctrlKey:j,metaKey:l}=s.nativeEvent,E=this.node&&this.node.querySelector("a");if(x){this.handleLargerSelectionArea(s);return}if(E!==s.target){if(A&&A(v),f&&(j||l)){window.open(f,"_blank");return}f&&E&&E.click()}},this.handleKeyUp=s=>{const{disabled:v,onClick:A=Xt,context:{selectMode:f}}=this.props,{key:x}=s;x==="Enter"&&this.props.url&&!f&&!v&&A()},this.handleActionsClick=()=>{this.setState(({actionsMenuVisible:s})=>({actionsMenuVisible:!s}))},this.handleCloseRequest=()=>{this.setState({actionsMenuVisible:!1})}}static getDerivedStateFromProps(i,s){const v=ht(i.id,i.context.selectedItems);return s.selected===v?null:{selected:v}}shouldComponentUpdate(i,s){const{children:v,context:{selectedItems:A,...f},...x}=i,{children:j,context:{selectedItems:l,...E},...V}=this.props,N=i.context.selectMode;return!at(this.state,s)||this.props.context.selectMode!==N||!i.context.selectMode&&(!at(V,x)||!at(E,f))}render(){const{children:i,url:s,external:v,media:A,shortcutActions:f,ariaControls:x,ariaExpanded:j,persistActions:l=!1,accessibilityLabel:E,name:V,context:{selectable:N,selectMode:m,hasBulkActions:de,loading:Z,resourceName:X},i18n:q,verticalAlignment:F,dataHref:C,breakpoints:U,onMouseOver:P,disabled:se}=this.props,{actionsMenuVisible:z,focused:pe,focusedInner:H,selected:b}=this.state;let M=null,B=null;if(N){const ie=V||E||q.translate("Polaris.Common.checkbox");B=a.createElement("div",{className:L.CheckboxWrapper,onClick:je,onChange:this.handleLargerSelectionArea},a.createElement(mt,null,te=>a.createElement(Vt,{id:te,label:ie,labelHidden:!0,checked:b,disabled:Z||se,bleedInlineStart:"300",bleedInlineEnd:"300",bleedBlockStart:"300",bleedBlockEnd:"300",fill:!0,labelClassName:L.CheckboxLabel})))}(A||N)&&(M=a.createElement(w,{gap:"300",blockAlign:A&&N?"center":ft(F)},B,A));const G=xe(L.ResourceItem,pe&&L.focused,N&&L.selectable,b&&L.selected,m&&L.selectMode,l&&L.persistActions,H&&L.focusedInner,se&&L.disabled),Ce=xe(L.ListItem,pe&&!H&&L.focused,de&&L.hasBulkActions,b&&L.selected,N&&L.selectable);let $=null,he=null;if(f&&!Z)if(l){$=U!=null&&U.lgUp?a.createElement("div",{className:L.Actions,onClick:je},a.createElement(Ze,null,ut(f,{variant:"tertiary"}))):null;const ie=V?q.translate("Polaris.ResourceList.Item.actionsDropdownLabel",{accessibilityLabel:V}):q.translate("Polaris.ResourceList.Item.actionsDropdown");he=!m&&(U!=null&&U.lgDown)?a.createElement("div",{onClick:je},a.createElement(_t,{activator:a.createElement(ke,{accessibilityLabel:ie,onClick:this.handleActionsClick,variant:"tertiary",icon:wt}),onClose:this.handleCloseRequest,active:z},a.createElement(Nt,{items:f}))):null}else U!=null&&U.lgUp&&($=a.createElement("div",{className:L.Actions,onClick:je},a.createElement(st,{position:"absolute",insetBlockStart:"400",insetInlineEnd:"500"},a.createElement(Ze,{variant:"segmented"},ut(f,{size:"slim"})))));const ae=a.createElement(st,{id:this.props.id,position:"relative",paddingInlineStart:"300",paddingInlineEnd:"300",paddingBlockStart:"300",paddingBlockEnd:"300",zIndex:"var(--pc-resource-item-content-stacking-order)"},a.createElement(pt,{columns:{xs:"1fr auto"}},a.createElement(pt,{columns:{xs:A||N?"auto 1fr":"1fr"},gap:"300"},M,a.createElement(w,{blockAlign:ft(F)},a.createElement(st,{width:"100%",padding:"0"},i))),$,he)),Q=Z?-1:0,ee=E||q.translate("Polaris.ResourceList.Item.viewItem",{itemName:V||X&&X.singular||""}),re=s?a.createElement(mt,null,ie=>a.createElement(Wt,{"aria-describedby":this.props.id,"aria-label":ee,className:L.Link,url:s,external:v,tabIndex:Q,id:ie,ref:this.overlayRef})):a.createElement("button",{className:L.Button,"aria-label":ee,"aria-controls":x,"aria-expanded":j,onClick:this.handleClick,tabIndex:Q,ref:this.buttonOverlay});return a.createElement("li",{className:Ce,"data-href":C},a.createElement("div",{className:L.ItemWrapper},a.createElement("div",{ref:this.setNode,className:G,onClick:se?()=>{}:this.handleClick,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyUp:this.handleKeyUp,onMouseOver:P,onMouseOut:this.handleMouseOut,"data-href":s},se?null:re,ae)))}}function Xt(){}function je(e){e.stopPropagation()}function ht(e,i){return!!(i&&(Array.isArray(i)&&i.includes(e)||i===Y))}function Qt(e){const i=Ft();return a.createElement(Yt,Object.assign({},e,{breakpoints:i,context:r.useContext(At),i18n:yt()}))}function ft(e){switch(e){case"leading":return"start";case"trailing":return"end";case"center":return"center";case"fill":return"stretch";case"baseline":return"baseline";default:return"start"}}function mt(e){const i=r.useId();return e.children(i)}var g={FiltersWrapper:"Polaris-ResourceList__FiltersWrapper",ResourceListWrapper:"Polaris-ResourceList__ResourceListWrapper",ResourceList:"Polaris-ResourceList",HeaderOuterWrapper:"Polaris-ResourceList__HeaderOuterWrapper",BulkActionsWrapper:"Polaris-ResourceList__BulkActionsWrapper","HeaderWrapper-disabled":"Polaris-ResourceList__HeaderWrapper--disabled","HeaderWrapper-overlay":"Polaris-ResourceList__HeaderWrapper--overlay",HeaderWrapper:"Polaris-ResourceList__HeaderWrapper","HeaderWrapper-isSticky":"Polaris-ResourceList__HeaderWrapper--isSticky",HeaderContentWrapper:"Polaris-ResourceList__HeaderContentWrapper","HeaderWrapper-inSelectMode":"Polaris-ResourceList__HeaderWrapper--inSelectMode",SortWrapper:"Polaris-ResourceList__SortWrapper",AlternateToolWrapper:"Polaris-ResourceList__AlternateToolWrapper","HeaderWrapper-hasSelect":"Polaris-ResourceList__HeaderWrapper--hasSelect","HeaderWrapper-hasAlternateTool":"Polaris-ResourceList__HeaderWrapper--hasAlternateTool","HeaderWrapper-hasSort":"Polaris-ResourceList__HeaderWrapper--hasSort",HeaderTitleWrapper:"Polaris-ResourceList__HeaderTitleWrapper",BulkActionsWrapperVisible:"Polaris-ResourceList__BulkActionsWrapperVisible",PaginationWrapper:"Polaris-ResourceList__PaginationWrapper",CheckableButtonWrapper:"Polaris-ResourceList__CheckableButtonWrapper",SelectButtonWrapper:"Polaris-ResourceList__SelectButtonWrapper",EmptySearchResultWrapper:"Polaris-ResourceList__EmptySearchResultWrapper",ItemWrapper:"Polaris-ResourceList__ItemWrapper","ItemWrapper-isLoading":"Polaris-ResourceList__ItemWrapper--isLoading",SpinnerContainer:"Polaris-ResourceList__SpinnerContainer",LoadingOverlay:"Polaris-ResourceList__LoadingOverlay",disableTextSelection:"Polaris-ResourceList--disableTextSelection"};const en=28,tn=45;function gt(e,i){return e.map((s,v)=>i(s,v))}const we=()=>typeof window>"u"?!1:window.innerWidth<parseFloat(zt($t.breakpoints["breakpoints-sm"])??"");function nn(e,i){return Object.prototype.hasOwnProperty.call(e,"id")?e.id:i.toString()}function it({items:e,filterControl:i,flushFilters:s,emptyState:v,emptySearchState:A,resourceName:f,promotedBulkActions:x,bulkActions:j,selectedItems:l=[],isFiltered:E,selectable:V,hasMoreItems:N,loading:m,headerContent:de,showHeader:Z,totalItemsCount:X,sortValue:q,sortOptions:F,alternateTool:C,onSortChange:U,onSelectionChange:P,renderItem:se,idForItem:z=nn,resolveItemId:pe,pagination:H}){const b=yt(),[M,B]=r.useState(!!(l&&l.length>0)),[G,Ce]=r.useState(0),[$,he]=r.useState(),[ae,Q]=r.useState(we()),ee=r.useReducer((o=0)=>o+1,0)[1],re=r.useRef(null),ie=Tt(()=>({singular:b.translate("Polaris.ResourceList.defaultItemSingular"),plural:b.translate("Polaris.ResourceList.defaultItemPlural")})),te=r.useRef(null),S=o=>{B(o),!o&&P&&P([])},u=Ut(()=>{const o=we();l&&l.length===0&&M&&!o&&S(!1),ae!==o&&Q(o)},50,{leading:!0,trailing:!0,maxWait:50});Bt("resize",u);const W=!!(x&&x.length>0||j&&j.length>0||V)&&!ae,fe=r.useMemo(()=>{let o="indeterminate";return!l||Array.isArray(l)&&l.length===0?o=!1:(l===Y||Array.isArray(l)&&l.length===e.length)&&(o=!0),o},[e.length,l]),T=f||ie.current,We=()=>{const o=e.length,h=!m&&(!X&&o===1||X===1)?T.singular:T.plural;return m?b.translate("Polaris.ResourceList.loading",{resource:h}):X?b.translate("Polaris.ResourceList.showingTotalCount",{itemsCount:o,totalItemsCount:X,resource:h}):de||b.translate("Polaris.ResourceList.showing",{itemsCount:o,resource:h})},[Ke,qe]=r.useState(l===Y?`${e.length}+`:l.length);r.useEffect(()=>{(l===Y||l.length>0)&&qe(l===Y?`${e.length}+`:l.length)},[l,e.length]);const Ge=b.translate("Polaris.ResourceList.selected",{selectedItemsCount:Ke}),Pe=r.useMemo(()=>{const o=l.length,h=e.length,_=o===h;return h===1&&_?b.translate("Polaris.ResourceList.a11yCheckboxDeselectAllSingle",{resourceNameSingular:T.singular}):h===1?b.translate("Polaris.ResourceList.a11yCheckboxSelectAllSingle",{resourceNameSingular:T.singular}):_?b.translate("Polaris.ResourceList.a11yCheckboxDeselectAllMultiple",{itemsLength:e.length,resourceNamePlural:T.plural}):b.translate("Polaris.ResourceList.a11yCheckboxSelectAllMultiple",{itemsLength:e.length,resourceNamePlural:T.plural})},[b,e.length,T.singular,T.plural,l.length]),Te=r.useMemo(()=>{if(!(!W||!N)&&l===Y)return b.translate(E?"Polaris.ResourceList.allFilteredItemsSelected":"Polaris.ResourceList.allItemsSelected",{itemsLength:e.length,resourceNamePlural:T.plural})},[N,b,E,W,e,T.plural,l]),Be=r.useCallback(()=>{const o=l===Y?gt(e,z):Y;P&&P(o)},[z,e,P,l]),me=r.useMemo(()=>!W||!N?void 0:{content:l===Y?b.translate("Polaris.Common.undo"):b.translate(E?"Polaris.ResourceList.selectAllFilteredItems":"Polaris.ResourceList.selectAllItems",{itemsLength:e.length,resourceNamePlural:T.plural}),onAction:Be},[Be,N,b,E,W,e.length,T.plural,l]),ge={title:b.translate("Polaris.ResourceList.emptySearchResultTitle",{resourceNamePlural:T.plural}),description:b.translate("Polaris.ResourceList.emptySearchResultDescription")},le=r.useCallback(()=>{if(te.current!=null){if(typeof window>"u")return;const o=te.current.getBoundingClientRect(),h=Math.max(document.documentElement?document.documentElement.clientHeight:0,window.innerHeight||0),_=h-o.height,ve=e.length===1?en:tn,J=_>0?(o.height-ve)/2:(h-o.top-ve)/2;Ce(J)}},[te,e.length]),ye=e.length>0;r.useEffect(()=>{m&&le()},[m,le]),r.useEffect(()=>{l&&l.length>0&&!M&&B(!0),(!l||l.length===0)&&!we()&&B(!1)},[l,M]),r.useEffect(()=>{ee()},[ee,e]);const oe=(o,h)=>{const _=z(o,h);return se(o,_,h)},Je=(o,h,_)=>{const ve=Math.min(o,h),J=Math.max(o,h);return e.slice(ve,J+1).map(_)},Ye=(o,h,_,ve)=>{if(l==null||P==null)return;let J=l===Y?gt(e,z):[...l];_!==void 0&&he(_);const ot=$;let nt=[h];if(ve&&ot!=null&&_!==void 0&&pe&&(nt=Je(ot,_,pe)),J=[...new Set([...J,...nt])],!o)for(const jt of nt)J.splice(J.indexOf(jt),1);J.length===0&&!we()?S(!1):J.length>0&&S(!0),P&&P(J)},De=()=>{let o;Array.isArray(l)&&l.length===e.length||l===Y?o=[]:o=e.map((h,_)=>z(h,_)),o.length===0&&!we()?S(!1):o.length>0&&S(!0),P&&P(o),setTimeout(()=>{var h;(h=re==null?void 0:re.current)==null||h.focus()},0)},He=xe(g.BulkActionsWrapper,M&&g.BulkActionsWrapperVisible),Me=W?a.createElement("div",{className:He},a.createElement(qt,{selectMode:M,onSelectModeToggle:S,label:Ge,paginatedSelectAllAction:me,paginatedSelectAllText:Te,promotedActions:x,actions:j,disabled:m,accessibilityLabel:Pe,selected:fe,onToggleAll:De,ref:re,buttonSize:"medium"})):null,Oe=i?a.createElement("div",{className:xe(!s&&g.FiltersWrapper)},i):null,Ie=F&&F.length>0&&!C?a.createElement("div",{className:g.SortWrapper},a.createElement(Ne,{label:b.translate("Polaris.ResourceList.sortingLabel"),labelInline:!ae,labelHidden:ae,options:F,onChange:U,value:q,disabled:M})):null,Fe=C&&!Ie?a.createElement("div",{className:g.AlternateToolWrapper},C):null,t=a.createElement("div",{className:g.HeaderTitleWrapper},a.createElement(k,{as:"span",variant:"bodyMd"},We())),c=W?a.createElement("div",{className:g.SelectButtonWrapper},a.createElement(ke,{disabled:M,icon:Et,onClick:()=>S(!0)},b.translate("Polaris.ResourceList.selectButtonText"))):null,p=W?a.createElement("div",{className:g.CheckableButtonWrapper},a.createElement(Zt,{accessibilityLabel:Pe,label:We(),onToggleAll:De,disabled:m,ref:re,selected:fe})):null,y=W||F&&F.length>0||C,Ee=m?a.createElement("div",{className:g["HeaderWrapper-overlay"]}):null,ne=v&&!ye&&!m,be=!ne&&i&&!ye&&!m,Se=!ne&&Z!==!1&&!be&&(Z||y)&&te.current&&a.createElement("div",{className:g.HeaderOuterWrapper},a.createElement(Gt,{boundingElement:te.current},o=>{const h=xe(g.HeaderWrapper,F&&F.length>0&&!C&&g["HeaderWrapper-hasSort"],C&&g["HeaderWrapper-hasAlternateTool"],W&&g["HeaderWrapper-hasSelect"],m&&g["HeaderWrapper-disabled"],W&&M&&Me&&g["HeaderWrapper-inSelectMode"],o&&g["HeaderWrapper-isSticky"]);return a.createElement("div",{className:h},Ee,a.createElement("div",{className:g.HeaderContentWrapper},t,p,Fe,Ie,c),Me)})),Re=be?A||a.createElement("div",{className:g.EmptySearchResultWrapper},a.createElement(Kt,Object.assign({},ge,{withIllustration:!0}))):null,Le=ne?v:null,Qe={paddingTop:`${G>0?G:8}px`},et=e.length<2?"small":"large",Ue=m?a.createElement(a.Fragment,null,a.createElement("li",{className:g.SpinnerContainer,style:Qe},a.createElement(Dt,{size:et,accessibilityLabel:"Items are loading"})),a.createElement("li",{className:g.LoadingOverlay})):null,_e=xe(g.ItemWrapper,m&&g["ItemWrapper-isLoading"]),tt=m&&!ye?a.createElement("div",{className:_e,tabIndex:-1},Ue):null,d=xe(g.ResourceList,m&&g.disabledPointerEvents,M&&g.disableTextSelection),O=ye?a.createElement("ul",{className:d,ref:te,"aria-live":"polite","aria-busy":m},Ue,r.Children.toArray(e.map(oe))):null,R=H?a.createElement("div",{className:g.PaginationWrapper},a.createElement(Ht,Object.assign({type:"table"},H))):null,I={selectable:W,selectedItems:l,selectMode:M,hasBulkActions:!!j,resourceName:T,loading:m,onSelectionChange:Ye};return a.createElement(At.Provider,{value:I},Oe,a.createElement("div",{className:g.ResourceListWrapper},Se,O,Re,Le,tt,R))}it.Item=Qt;const bt="/app/inbox/telemetry",sn=e=>{if(!(typeof window>"u"))try{const i=JSON.stringify(e);if(typeof navigator<"u"&&typeof navigator.sendBeacon=="function"){const s=new Blob([i],{type:"application/json"});navigator.sendBeacon(bt,s);return}fetch(bt,{method:"POST",headers:{"Content-Type":"application/json"},body:i,keepalive:!0})}catch{}},an=e=>{const i={...e,timestamp:new Date().toISOString()};sn(i)},rn={email:"Email",shopify:"Shopify",instagram:"Instagram",tiktok:"TikTok",chat:"Chat",sms:"SMS",social:"Social"},ln={open:"Open",snoozed:"Snoozed",resolved:"Resolved",escalated:"Escalated"},rt=e=>rn[e],St=e=>ln[e],vt=e=>e??"Unassigned",on=e=>{switch(e){case"customer_message":return"attention";case"agent_reply":return"success";case"note":return"warning";default:return"info"}},cn=e=>{switch(e){case"customer_message":return"Customer";case"agent_reply":return"Agent";case"note":return"Note";default:return"System"}},un=e=>{const i={};return e.forEach(s=>{i[s.id]=s.aiDraft.feedback}),i},dn={up:"Positive",down:"Negative"},lt={connecting:"Connecting",connected:"Live",reconnecting:"Reconnecting",offline:"Offline"},pn={connecting:"Establishing realtime sync…",connected:"Realtime inbox updates are active.",reconnecting:"Connection dropped. Retrying shortly…",offline:"Realtime sync unavailable. Manual refresh recommended until reconnected."},hn={connecting:"info",connected:"success",reconnecting:"warning",offline:"critical"},xt=e=>Object.prototype.hasOwnProperty.call(lt,e),fn={drafts:"Drafts",feedback:"Feedback",attachments:"Attachments"},mn=e=>e.length?e.map(i=>fn[i]??i).join(" • "):"None",gn=[{label:"All",value:"all"},{label:"Unassigned",value:"unassigned"},{label:"Priority",value:"priority"},{label:"Overdue",value:"overdue"}],bn=e=>{switch(e){case"positive":return"success";case"negative":return"critical";default:return"attention"}},kt=e=>{switch(e){case"urgent":return"critical";case"high":return"warning";case"medium":return"attention";default:return"new"}},Sn=e=>{switch(e){case"escalated":return"critical";case"resolved":return"success";case"snoozed":return"warning";default:return"attention"}},$e=e=>{const i=Date.now()-new Date(e).getTime(),s=Math.max(Math.round(i/(1e3*60*60)),0);return s<1?"just now":s===1?"1h ago":s<24?`${s}h ago`:`${Math.round(s/24)}d ago`};function Nn(){var Me,Oe,Ie,Fe;const{dataset:e,scenario:i,useMockData:s,refreshAfterSeconds:v}=Ct(),A=Pt(),[f]=Mt(),x=ct(),j=ct(),{revalidate:l}=It(),[E,V]=r.useState(((Me=e.tickets[0])==null?void 0:Me.id)??null),[N,m]=r.useState(((Oe=e.tickets[0])==null?void 0:Oe.aiDraft.content)??""),[de,Z]=r.useState(""),[X,q]=r.useState(()=>un(e.tickets)),[F,C]=r.useState(null),U=s?"connected":"connecting",[P,se]=r.useState("connecting"),[z,pe]=r.useState(U),[H,b]=r.useState(null),M=r.useRef(()=>{}),B=r.useRef(null),G=r.useRef(null),Ce=r.useRef(new Set),$=r.useCallback((t,c)=>{pe(p=>{if(p===t)return p;if(!(c!=null&&c.suppressToast)&&!s)if(t==="reconnecting"&&p==="connected"){const y=typeof(c==null?void 0:c.retryDelayMs)=="number"?Math.max(Math.round(c.retryDelayMs/1e3),1):null;C(y?`Assistants realtime bridge interrupted. Retrying in ${y}s…`:"Assistants realtime bridge interrupted. Retrying…")}else t==="offline"?C("Assistants realtime bridge offline. We'll keep retrying automatically."):t==="connected"&&(p==="offline"||p==="reconnecting")&&C("Assistants realtime bridge reconnected.");return t})},[C,s]);r.useEffect(()=>{s&&$("connected",{suppressToast:!0})},[$,s]);const he=r.useCallback(()=>{M.current()},[]),ae=r.useCallback(t=>{if(s||!t)return;const c=Ce.current;c.has(t)||(c.size>=128&&c.clear(),c.add(t),!G.current&&(G.current=setTimeout(()=>{G.current=null,l()},250)))},[l,s]),Q=r.useMemo(()=>P==="offline"||z==="offline"?"offline":P==="reconnecting"||z==="reconnecting"?"reconnecting":P==="connecting"||z==="connecting"?"connecting":"connected",[P,z]);r.useEffect(()=>()=>{G.current&&(clearTimeout(G.current),G.current=null)},[]);const ee=r.useMemo(()=>vn(e),[e]),re=r.useMemo(()=>[{label:"All channels",value:"all"},...e.availableFilters.channels.map(t=>({label:rt(t),value:t}))],[e.availableFilters.channels]),ie=r.useMemo(()=>[{label:"All statuses",value:"all"},...e.availableFilters.statuses.map(t=>({label:St(t),value:t}))],[e.availableFilters.statuses]),te=r.useMemo(()=>[{label:"All assignees",value:"all"},{label:"Unassigned",value:"unassigned"},...e.availableFilters.assignees.map(t=>({label:t,value:t}))],[e.availableFilters.assignees]),S=r.useMemo(()=>e.tickets.length?E?e.tickets.find(t=>t.id===E)??e.tickets[0]:e.tickets[0]:null,[e.tickets,E]),u=r.useMemo(()=>{if(!S)return null;const t=X[S.id];return t?{...S,aiDraft:{...S.aiDraft,feedback:t}}:S},[X,S]),W=r.useRef((S==null?void 0:S.id)??null);r.useEffect(()=>{W.current=(S==null?void 0:S.id)??null},[S==null?void 0:S.id]),r.useEffect(()=>{if(!e.tickets.length){V(null),m("");return}(!E||!e.tickets.some(t=>t.id===E))&&V(e.tickets[0].id)},[e.tickets,E]),r.useEffect(()=>{q(t=>{const c={...t};return e.tickets.forEach(p=>{const y=c[p.id];(!y||p.aiDraft.feedback.length>y.length)&&(c[p.id]=p.aiDraft.feedback)}),c})},[e.tickets]),r.useEffect(()=>{m(u?u.aiDraft.content:"")},[u]),r.useEffect(()=>{Z("")},[E]),r.useEffect(()=>{if(B.current&&(clearTimeout(B.current),B.current=null),s||!v||v<=0)return;let t=!1;const c=()=>{t||(B.current=setTimeout(()=>{B.current=null,l(),c()},v*1e3))};return c(),()=>{t=!0,B.current&&(clearTimeout(B.current),B.current=null)}},[v,l,s]),r.useEffect(()=>{if(typeof window>"u"||typeof EventSource>"u"){se("offline");return}let t=null,c=null,p=!1,y=0,Ee=0,ne=null,be="connecting",Se=!1,Re=!1;const Le=d=>{be=d,se(d)},Xe=()=>{if(ne!==null)return Math.max(Date.now()-ne,0)},ce=(d,O,R)=>{an({type:d,status:O,attempt:Ee,consecutiveFailures:y,scenario:i,useMockData:s,...R})},Qe=d=>{q(O=>{const R={...O};let I=!1;if(d.ticket)R[d.ticket.id]=d.ticket.aiDraft.feedback,I=!0;else if(d.feedback){const h=(R[d.feedback.ticketId]??[]).filter(_=>_.id!==d.feedback.id);R[d.feedback.ticketId]=[...h,d.feedback],I=!0}return I?R:O})},et=d=>{var O,R;if(d.type==="handshake"){b(d),y=0,Se=!1,ce("connection:handshake","connected",{latencyMs:Xe()}),ne=null,Le("connected");const I=(O=d.bridge)==null?void 0:O.status;I&&xt(I)?$(I,{suppressToast:!0}):s?$("connected",{suppressToast:!0}):$("connecting",{suppressToast:!0});return}if(d.type==="event"&&((R=d.event)==null?void 0:R.type)==="bridge:status"){const I=d.event.payload,o=I==null?void 0:I.status;if(o&&xt(o)){const h=typeof(I==null?void 0:I.retryDelayMs)=="number"?I.retryDelayMs:void 0;$(o,{retryDelayMs:h})}return}Qe(d),ae(d.id),d.draft&&d.draft.ticketId===W.current?m(d.draft.content):d.ticket&&d.ticket.id===W.current&&m(d.ticket.aiDraft.content),d.feedback&&d.feedback.ticketId===W.current&&Z(""),d.message&&C(d.message)},Ue=d=>{p||c||(ce("connection:retry",be,{retryDelayMs:d}),c=setTimeout(()=>{c=null,_e()},d))},_e=()=>{if(p)return;Ee+=1,ne=Date.now(),b(null);const d=Re?"connecting":y>0?"reconnecting":"connecting";Le(d),ce("connection:attempt",d),Re&&(ce("connection:manual-retry",d),Re=!1),t==null||t.close(),t=new EventSource("/app/inbox/stream"),t.onopen=()=>{y=0,Se=!1,ce("connection:open","connected",{latencyMs:Xe()}),Le("connected"),c&&(clearTimeout(c),c=null)},t.onmessage=O=>{try{const R=JSON.parse(O.data);et(R)}catch(R){console.error("inbox stream parse error",R)}},t.onerror=()=>{if(p)return;y+=1;const O=Math.min(y*2e3,15e3),R=y>=3?"offline":"reconnecting";ce("connection:error",R,{retryDelayMs:O}),R==="offline"&&!Se&&(ce("connection:offline","offline",{reason:"max-retries-exceeded"}),Se=!0),Le(R),y===1?C("Realtime updates interrupted. Attempting to reconnect…"):R==="offline"&&y===3&&C("Realtime updates are offline. We'll keep retrying in the background."),Ue(O)}},tt=()=>{p||(y=0,Se=!1,Re=!0,c&&(clearTimeout(c),c=null),_e())};return M.current=tt,_e(),()=>{p=!0,M.current=()=>{},t==null||t.close(),c&&clearTimeout(c)}},[ae,i,$,s]),r.useEffect(()=>{if(x.state!=="idle"||!x.data)return;const t=x.data.ticket;t&&(q(c=>({...c,[t.id]:t.aiDraft.feedback})),t.id===(u==null?void 0:u.id)&&m(t.aiDraft.content)),x.data.message&&C(x.data.message)},[u==null?void 0:u.id,x.data,x.state]),r.useEffect(()=>{if(j.state!=="idle"||!j.data)return;const{feedback:t,ticket:c,message:p}=j.data;t&&(q(y=>{const ne=(y[t.ticketId]??[]).filter(be=>be.id!==t.id);return{...y,[t.ticketId]:[...ne,t]}}),t.ticketId===(u==null?void 0:u.id)&&Z("")),c&&c.id===(u==null?void 0:u.id)&&m(c.aiDraft.content),p&&C(p)},[u==null?void 0:u.id,j.data,j.state]);const fe=(t,c)=>{const p=new URLSearchParams(f);(p.get(t)??"all")!==(c||"all")&&(!c||c==="all"?p.delete(t):p.set(t,c),A(`?${p.toString()}`,{replace:!0}))},T=t=>{fe("filter",t)},We=t=>{fe("channel",t)},Ke=t=>{fe("status",t)},qe=t=>{fe("assigned",t)},Ge=t=>{V(t),Z("")},Pe=t=>{u&&x.submit({intent:t,ticketId:u.id,content:N,updatedBy:"Operator"},{method:"post"})},Te=t=>{u&&j.submit({intent:"feedback",ticketId:u.id,draftId:u.aiDraft.id,vote:t,comment:de,submittedBy:"Operator"},{method:"post"})},Be=e.tickets.length>0,me=x.state!=="idle",ge=j.state!=="idle",le=(u==null?void 0:u.aiDraft.feedback)??[],ye=le.slice(-3).reverse(),oe=le[le.length-1],Je=H?H.provider.label:s?"Mock inbox provider":"Assistants bridge",Ye=H?`Capabilities: ${mn(H.capabilities)}`:s?"Mock provider handshake pending…":"Negotiating Assistants handshake…",De=`Bridge status: ${lt[z]}`,He=H!=null&&H.provider.transport?H.provider.transport.toUpperCase():null;return n.jsxs(Ot,{title:"Inbox",subtitle:"Monitor conversations, approvals, and SLA breaches across channels.",children:[n.jsxs(Ae,{children:[n.jsx(Ae.Section,{children:n.jsxs(K,{gap:"300",children:[(e.alert||e.error||s)&&n.jsxs(K,{gap:"200",children:[s&&n.jsx(ze,{tone:i==="warning"?"warning":"info",title:`Mock state: ${i}`,children:n.jsx("p",{children:"Adjust `mockState` in the query string to test UI permutations."})}),e.alert&&!e.error&&n.jsx(ze,{tone:"warning",title:"Inbox alert",children:n.jsx("p",{children:e.alert})}),e.error&&n.jsx(ze,{tone:"critical",title:"Inbox unavailable",children:n.jsx("p",{children:e.error})})]}),n.jsxs(w,{gap:"200",blockAlign:"center",children:[n.jsx(D,{tone:hn[Q],children:lt[Q]}),n.jsx(k,{variant:"bodySm",tone:"subdued",children:pn[Q]}),Q==="reconnecting"&&n.jsx(ke,{size:"slim",variant:"plain",onClick:he,accessibilityLabel:"Retry realtime connection",children:"Retry"})]}),n.jsxs(w,{gap:"150",blockAlign:"center",children:[n.jsx(D,{tone:"info",children:Je}),He?n.jsx(D,{tone:"subdued",children:He}):null,n.jsx(k,{variant:"bodySm",tone:"subdued",children:Ye}),n.jsx(k,{variant:"bodySm",tone:"subdued",children:De})]}),Q==="offline"&&n.jsx(ze,{tone:"critical",title:"Realtime updates paused",action:{content:"Retry connection",onAction:he},children:n.jsx("p",{children:"We will keep retrying automatically. Approvals continue, but updates may be stale."})}),n.jsx(ue,{title:"Tickets overview",sectioned:!0,children:n.jsxs(K,{gap:"200",children:[n.jsx(Ve,{label:"Outstanding",value:ee.outstanding,tone:"critical"}),n.jsx(Ve,{label:"Overdue",value:ee.overdue,tone:"warning"}),n.jsx(Ve,{label:"Approvals pending",value:ee.approvalsPending,tone:"attention"}),n.jsx(Ve,{label:"Escalated",value:ee.escalated})]})}),n.jsx(Ne,{label:"Ticket filter",options:gn,value:e.filter,onChange:T}),n.jsx(Ne,{label:"Channel",options:re,value:e.channelFilter,onChange:We}),n.jsx(Ne,{label:"Status",options:ie,value:e.statusFilter,onChange:Ke}),n.jsx(Ne,{label:"Assignee",options:te,value:e.assignedFilter,onChange:qe})]})}),n.jsx(Ae.Section,{children:n.jsxs(Ae,{children:[n.jsx(Ae.Section,{children:n.jsx(ue,{children:n.jsx(it,{resourceName:{singular:"ticket",plural:"tickets"},items:e.tickets,renderItem:t=>n.jsx(it.Item,{id:t.id,accessibilityLabel:`View ${t.subject}`,onClick:()=>Ge(t.id),selected:t.id===(S==null?void 0:S.id),children:n.jsxs(K,{gap:"100",children:[n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsx(k,{variant:"headingSm",as:"h3",children:t.subject}),n.jsxs(w,{gap:"200",blockAlign:"center",children:[n.jsx(D,{tone:kt(t.priority),children:t.priority}),n.jsx(D,{tone:bn(t.sentiment),children:t.sentiment}),n.jsx(D,{tone:"info",children:rt(t.channel)})]})]}),n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsxs(k,{as:"span",variant:"bodySm",tone:"subdued",children:[t.customer.name," • ",vt(t.assignedTo)]}),n.jsx(k,{as:"span",variant:"bodySm",tone:"subdued",children:$e(t.updatedAt)})]}),n.jsx(k,{variant:"bodySm",as:"p",children:t.lastMessagePreview})]})})})})}),n.jsx(Ae.Section,{secondary:!0,children:Be&&u?n.jsxs(ue,{title:u.subject,children:[n.jsx(ue.Section,{children:n.jsxs(K,{gap:"200",children:[n.jsxs(w,{gap:"200",blockAlign:"center",children:[n.jsx(D,{tone:Sn(u.status),children:St(u.status)}),n.jsx(D,{tone:kt(u.priority),children:u.priority}),n.jsx(D,{tone:"info",children:rt(u.channel)}),n.jsx(D,{tone:u.aiDraft.approved?"success":"attention",children:u.aiDraft.approved?"Approved":"Needs review"})]}),n.jsxs(k,{variant:"bodySm",tone:"subdued",as:"p",children:[u.customer.name," • ",vt(u.assignedTo)]})]})}),n.jsx(ue.Section,{children:n.jsxs(K,{gap:"200",children:[n.jsx(k,{variant:"headingSm",as:"h3",children:"Conversation timeline"}),u.timeline.length?n.jsx(K,{gap:"200",children:u.timeline.map((t,c)=>n.jsxs(K,{gap:"150",children:[n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsxs(w,{gap:"150",blockAlign:"center",children:[n.jsx(D,{tone:on(t.type),children:cn(t.type)}),n.jsx(k,{variant:"bodySm",as:"span",children:t.actor})]}),n.jsx(k,{tone:"subdued",variant:"bodySm",as:"span",children:$e(t.timestamp)})]}),n.jsx(k,{variant:"bodySm",as:"p",children:t.body}),t.attachments&&t.attachments.length>0?n.jsx(w,{gap:"150",children:t.attachments.map(p=>n.jsx(D,{tone:"info",children:p.name},p.id))}):null]},t.id))}):n.jsx(k,{variant:"bodySm",tone:"subdued",children:"Timeline events will appear here as messages arrive."})]})}),n.jsx(ue.Section,{children:n.jsxs(K,{gap:"200",children:[n.jsx(dt,{label:"AI draft response",multiline:!0,autoComplete:"off",value:N,onChange:t=>m(t),helpText:`Last updated ${$e(u.aiDraft.updatedAt)} by ${u.aiDraft.updatedBy}`,disabled:me}),n.jsx(k,{tone:"subdued",variant:"bodySm",children:"Provide edits or approve to log feedback for future training iterations."}),n.jsx(w,{align:"end",children:n.jsxs(Ze,{children:[n.jsx(ke,{onClick:()=>Pe("edit"),loading:me,children:"Save edits"}),n.jsx(ke,{primary:!0,onClick:()=>Pe("approve"),loading:me,children:"Approve draft"})]})})]})}),n.jsx(ue.Section,{subdued:!0,children:n.jsxs(K,{gap:"200",children:[n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsx(k,{variant:"headingSm",as:"h3",children:"Draft feedback"}),le.length?n.jsx(D,{tone:"info",children:le.length}):null]}),n.jsx(w,{gap:"200",children:n.jsxs(Ze,{children:[n.jsx(ke,{icon:Lt,tone:"success",pressed:(oe==null?void 0:oe.vote)==="up",onClick:()=>Te("up"),loading:ge&&((Ie=j.formData)==null?void 0:Ie.get("vote"))==="up",disabled:me||ge,children:"Upvote"}),n.jsx(ke,{icon:Rt,tone:"critical",pressed:(oe==null?void 0:oe.vote)==="down",onClick:()=>Te("down"),loading:ge&&((Fe=j.formData)==null?void 0:Fe.get("vote"))==="down",disabled:me||ge,children:"Downvote"})]})}),n.jsx(dt,{label:"Feedback notes (optional)",multiline:!0,autoComplete:"off",value:de,onChange:t=>Z(t),disabled:ge}),le.length?n.jsxs(K,{gap:"100",children:[n.jsx(k,{variant:"bodySm",tone:"subdued",children:"Recent feedback signals"}),ye.map(t=>n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsxs(w,{gap:"150",blockAlign:"center",children:[n.jsx(D,{tone:t.vote==="up"?"success":"critical",children:dn[t.vote]}),n.jsx(k,{variant:"bodySm",as:"span",children:t.submittedBy})]}),n.jsx(k,{variant:"bodySm",tone:"subdued",as:"span",children:$e(t.submittedAt)})]},t.id))]}):n.jsx(k,{variant:"bodySm",tone:"subdued",children:"No feedback submitted yet."})]})})]}):n.jsx(ue,{sectioned:!0,children:n.jsxs(K,{gap:"200",children:[n.jsx(k,{variant:"headingSm",as:"h3",children:"No tickets match the current filters."}),n.jsx(k,{tone:"subdued",variant:"bodySm",children:"Adjust the filters on the left to review other inbox conversations."})]})})})]})})]}),F&&n.jsx(Jt,{content:F,duration:3e3,onDismiss:()=>C(null)})]})}const vn=e=>{const i=e.tickets.filter(f=>f.status!=="resolved").length,s=e.tickets.filter(f=>f.slaBreached).length,v=e.tickets.filter(f=>f.priority!=="low"&&f.status==="open").length,A=e.tickets.filter(f=>f.status==="escalated").length;return{outstanding:i,overdue:s,approvalsPending:v,escalated:A}};function Ve({label:e,value:i,tone:s}){return n.jsxs(w,{align:"space-between",blockAlign:"center",children:[n.jsx(k,{variant:"bodyMd",as:"span",children:e}),n.jsx(D,{tone:s,children:i})]})}export{Nn as default};
