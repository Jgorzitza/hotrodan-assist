import{r as i,j as e}from"./index-DZoorY08.js";import{u as Oe,a as Ie,d as Be,F as C}from"./components-CTA1UUXK.js";import{c as I,P as _e,e as de,C as o,b as g,I as T,T as p,B as x,a as b,h as ce}from"./Page-CO1VPtMw.js";import{T as $e}from"./TitleBar-DFMSJ8Yc.js";import{B as me}from"./Banner-DCanv2aO.js";import{L as w}from"./Layout-Drv8ZkBJ.js";import{D as he}from"./DataTable-DOlFJz1k.js";import{F as B}from"./FormLayout-Cauguaew.js";import{D as pe}from"./Divider-DdX0k3iD.js";import{C as f}from"./Checkbox-drAGhQ4I.js";import"./context-CVB7tZr2.js";import"./index-1GQyLQny.js";import"./AfterInitialMount-C-VclerA.js";import"./Sticky-3Wxpi6V4.js";const Le=new Proxy({},{get(r,R){throw Error(`shopify.${String(R)} can't be used in a server environment. You likely need to move this code into an Effect.`)}});function He(){if(typeof window>"u")return Le;if(!window.shopify)throw Error("The shopify global is not defined. This likely means the App Bridge script tag was not added correctly to this page");return window.shopify}const ue={ga4:{label:"Google Analytics 4",description:"Used for traffic, conversions, and anomaly detection widgets."},gsc:{label:"Google Search Console",description:"Required for keyword rankings and crawl issue surfacing."},bing:{label:"Bing Webmaster Tools",description:"Optional, powers supplemental keyword audits."},mcp:{label:"Shopify MCP",description:"Powers storefront intelligence. Provide the MCP API key issued for this shop."}},Ne=r=>{switch(r){case"success":return{tone:"success",label:"Success"};case"warning":return{tone:"warning",label:"Warning"};default:return{tone:"critical",label:"Error"}}},ge=r=>{switch(r){case"healthy":return{tone:"success",label:"Healthy"};case"unhealthy":return{tone:"critical",label:"Unhealthy"};default:return{tone:"warning",label:"Unknown"}}},xe=100,be=12e4,fe=0,ve=10,v=r=>r?r.slice(0,10):"";function et(){var H,N,W,F,U,V,X,q;const{settings:r,useMockData:R,mcpOverrides:a,healthChecks:je,envStatus:Se}=Oe(),s=Ie(),y=Be(),_=He(),[P,E]=i.useState(r.thresholds),[u,m]=i.useState(r.toggles),[ye,A]=i.useState({ga4:"",gsc:"",bing:"",mcp:""}),[Me,$]=i.useState({ga4:v((H=r.secrets.ga4)==null?void 0:H.rotationReminderAt),gsc:v((N=r.secrets.gsc)==null?void 0:N.rotationReminderAt),bing:v((W=r.secrets.bing)==null?void 0:W.rotationReminderAt),mcp:v((F=r.secrets.mcp)==null?void 0:F.rotationReminderAt)}),[j,L]=i.useState(a),[O,M]=i.useState({endpoint:a.endpoint??"",timeoutMs:a.timeoutMs?String(a.timeoutMs):"",maxRetries:a.maxRetries?String(a.maxRetries):""}),[ke,Ce]=i.useState(je),[we,Te]=i.useState(Se);i.useEffect(()=>{var t,n,c,l;E(r.thresholds),m(r.toggles),$({ga4:v((t=r.secrets.ga4)==null?void 0:t.rotationReminderAt),gsc:v((n=r.secrets.gsc)==null?void 0:n.rotationReminderAt),bing:v((c=r.secrets.bing)==null?void 0:c.rotationReminderAt),mcp:v((l=r.secrets.mcp)==null?void 0:l.rotationReminderAt)})},[r]),i.useEffect(()=>{L(a),M({endpoint:a.endpoint??"",timeoutMs:a.timeoutMs?String(a.timeoutMs):"",maxRetries:a.maxRetries?String(a.maxRetries):""})},[a]),i.useEffect(()=>{s!=null&&s.healthChecks&&Ce(s.healthChecks),s!=null&&s.envStatus&&Te(s.envStatus)},[s]),i.useEffect(()=>{var t;s!=null&&s.toast&&_.toast.show({message:s.toast.message,isError:s.toast.status==="error",duration:4e3}),s!=null&&s.ok&&((t=s.meta)==null?void 0:t.intent)==="update-secret"&&A(n=>{var c;return{...n,[(c=s.meta)==null?void 0:c.provider]:""}})},[s,_]),i.useEffect(()=>{var t;if(s!=null&&s.ok&&((t=s.meta)==null?void 0:t.intent)==="update-mcp-overrides"&&s.mcpOverrides){const n=s.mcpOverrides;L(n),M({endpoint:n.endpoint??"",timeoutMs:n.timeoutMs?String(n.timeoutMs):"",maxRetries:n.maxRetries?String(n.maxRetries):""})}},[s]);const S=(s==null?void 0:s.fieldErrors)??{},k=t=>{var n;return y.state==="ting"&&((n=y.formData)==null?void 0:n.get("intent"))===t},Ee=ke.map(t=>[t.service,e.jsx(I,{tone:ge(t.status).tone,children:ge(t.status).label},`${t.service}-status`),`${t.responseTime}ms`,t.message,new Date(t.lastChecked).toLocaleString()]),Re=Object.entries(we).map(([t,n])=>[t,e.jsx(I,{tone:n.present?"success":"critical",children:n.present?"Set":"Missing"},`${t}-status`),n.value||"Not configured"]);return e.jsxs(_e,{title:"Settings",subtitle:"Manage operational thresholds, API access, and feature flags.",children:[e.jsx($e,{title:"Settings"}),R&&e.jsx(de,{paddingBlockStart:"400",children:e.jsx(me,{title:"Mock data enabled",tone:"info",children:e.jsx("p",{children:"Changes apply to in-memory fixtures. Clear the server to reset or set `USE_MOCK_DATA=false` to connect to live Shopify data."})})}),e.jsxs(w,{children:[e.jsx(w.Section,{children:e.jsxs(o,{children:[e.jsx(o,{title:"System Health"}),e.jsx(o,{children:e.jsxs(g,{gap:"400",children:[e.jsxs(T,{align:"space-between",blockAlign:"center",children:[e.jsx(p,{as:"h3",variant:"headingMd",children:"Backend Services"}),e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"refresh-health"}),e.jsx(x,{loading:k("refresh-health"),size:"slim",children:"Refresh"})]})]}),e.jsx(he,{columnContentTypes:["text","text","text","text","text"],headings:["Service","Status","Response Time","Message","Last Checked"],rows:Ee})]})})]})}),e.jsx(w.Section,{children:e.jsxs(o,{children:[e.jsx(o,{title:"Environment Variables"}),e.jsx(o,{children:e.jsxs(g,{gap:"400",children:[e.jsx(p,{as:"h3",variant:"headingMd",children:"Configuration Status"}),e.jsx(he,{columnContentTypes:["text","text","text"],headings:["Variable","Status","Value"],rows:Re})]})})]})}),e.jsx(w.Section,{children:e.jsxs(o,{children:[e.jsx(o,{title:"Operational thresholds"}),e.jsx(o,{children:e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"update-thresholds"}),e.jsxs(B,{children:[e.jsx(b,{label:"Low-stock minimum",type:"number",name:"lowStockMinimum",value:String(P.lowStockMinimum),onChange:t=>E(n=>({...n,lowStockMinimum:Number(t||0)})),min:0,autoComplete:"off",error:((U=s==null?void 0:s.meta)==null?void 0:U.intent)==="update-thresholds"?S.lowStockMinimum:void 0,helpText:"Trigger low-stock alerts when inventory drops below this value."}),e.jsx(b,{label:"Overdue order hours",type:"number",name:"overdueOrderHours",value:String(P.overdueOrderHours),onChange:t=>E(n=>({...n,overdueOrderHours:Number(t||0)})),min:1,autoComplete:"off",error:((V=s==null?void 0:s.meta)==null?void 0:V.intent)==="update-thresholds"?S.overdueOrderHours:void 0,helpText:"Orders exceeding this window surface in the orders dashboard."}),e.jsx(b,{label:"Overstock percentage",type:"number",name:"overstockPercentage",value:String(P.overstockPercentage),onChange:t=>E(n=>({...n,overstockPercentage:Number(t||0)})),min:0,autoComplete:"off",error:((X=s==null?void 0:s.meta)==null?void 0:X.intent)==="update-thresholds"?S.overstockPercentage:void 0,helpText:"Inventory flagged as overstock when buffer exceeds this percentage."}),e.jsx(x,{primary:!0,loading:k("update-thresholds"),children:"Save thresholds"})]})]})})]})}),e.jsx(w.Section,{children:e.jsxs(o,{children:[e.jsx(o,{title:"Integrations"}),e.jsx(o,{children:e.jsx(g,{gap:"400",children:Object.keys(ue).map(t=>{var Q,Y,Z,D,ee,te,se,ne,re,oe,ae,ie,le;const n=ue[t],c=r.secrets[t],l=r.connections[t],z=Ne(l.status),Pe=((Q=s==null?void 0:s.meta)==null?void 0:Q.provider)===t?S[`secret-${t}`]:void 0,G=k("update-secret")&&((Y=y.formData)==null?void 0:Y.get("provider"))===t,Ae=t==="mcp"?"Paste MCP API key":"Paste API key or service account JSON",J=t==="mcp"?j.endpoint?`Routing via ${j.endpoint}.`:"Falling back to MCP_API_URL or mock transport.":void 0,K=t==="mcp"&&k("update-mcp-overrides");return e.jsx(de,{padding:"400",borderWidth:"025",borderRadius:"200",borderColor:"border-subdued",children:e.jsxs(g,{gap:"300",children:[e.jsxs(T,{align:"space-between",blockAlign:"center",children:[e.jsxs(g,{gap:"100",children:[e.jsx(p,{as:"h3",variant:"headingMd",children:n.label}),e.jsx(p,{as:"p",variant:"bodySm",tone:"subdued",children:n.description})]}),e.jsx(I,{tone:z.tone,children:z.label})]}),l.message&&e.jsx(me,{tone:l.status==="error"?"critical":"warning",title:l.message,children:e.jsxs(p,{as:"p",variant:"bodySm",children:["Last checked ",l.lastCheckedAt??"never"]})}),e.jsxs(g,{gap:"200",children:[e.jsxs(p,{as:"p",variant:"bodySm",children:["Stored credential: "," ",(c==null?void 0:c.maskedValue)??"Not configured"]}),e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"update-secret"}),e.jsx("input",{type:"hidden",name:"provider",value:t}),e.jsxs(B,{children:[e.jsx(b,{label:"New credential",type:"text",name:"secret",autoComplete:"off",value:ye[t],onChange:d=>A(h=>({...h,[t]:d})),placeholder:Ae,error:Pe}),e.jsx(b,{label:"Rotation reminder",type:"date",name:"rotationReminderAt",value:Me[t],onChange:d=>$(h=>({...h,[t]:d}))}),e.jsxs(T,{gap:"200",children:[e.jsx(x,{primary:!0,name:"actionType",value:"save",loading:G&&((Z=y.formData)==null?void 0:Z.get("actionType"))!=="remove",children:"Save credential"}),e.jsx(x,{variant:"secondary",tone:"critical",name:"actionType",value:"remove",disabled:!c,loading:G&&((D=y.formData)==null?void 0:D.get("actionType"))==="remove",onClick:()=>A(d=>({...d,[t]:""})),children:"Remove credential"})]})]})]})]}),t==="mcp"&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{}),e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"update-mcp-overrides"}),e.jsxs(g,{gap:"200",children:[e.jsx(p,{as:"p",variant:"bodySm",children:"Override MCP connection settings for this shop. Leave fields blank to inherit environment defaults."}),e.jsxs(p,{as:"p",variant:"bodySm",tone:"subdued",children:["Current endpoint: "," ",j.endpoint??"Environment-supplied or mock transport",j.timeoutMs?` • Timeout ${j.timeoutMs} ms`:"",typeof j.maxRetries=="number"?` • Max retries ${j.maxRetries}`:""]}),e.jsxs(B,{children:[e.jsx(b,{label:"Endpoint override",type:"text",name:"endpoint",autoComplete:"off",value:O.endpoint,onChange:d=>M(h=>({...h,endpoint:d})),placeholder:"https://example.com/mcp",error:((ee=s==null?void 0:s.meta)==null?void 0:ee.intent)==="update-mcp-overrides"?S["mcp-endpoint"]:void 0,helpText:"Provide a fully qualified HTTP(S) endpoint."}),e.jsx(b,{label:"Request timeout (ms)",type:"number",name:"timeoutMs",value:O.timeoutMs,onChange:d=>M(h=>({...h,timeoutMs:d})),min:xe,max:be,inputMode:"numeric",error:((te=s==null?void 0:s.meta)==null?void 0:te.intent)==="update-mcp-overrides"?S["mcp-timeoutMs"]:void 0,helpText:`Allowed range ${xe}-${be} ms.`}),e.jsx(b,{label:"Max retries",type:"number",name:"maxRetries",value:O.maxRetries,onChange:d=>M(h=>({...h,maxRetries:d})),min:fe,max:ve,inputMode:"numeric",error:((se=s==null?void 0:s.meta)==null?void 0:se.intent)==="update-mcp-overrides"?S["mcp-maxRetries"]:void 0,helpText:`Allowed range ${fe}-${ve}.`}),((ne=s==null?void 0:s.meta)==null?void 0:ne.intent)==="update-mcp-overrides"&&s.formErrors&&e.jsx(ce,{message:s.formErrors.join(", "),fieldID:"mcp-overrides"})]}),e.jsxs(T,{gap:"200",children:[e.jsx(x,{primary:!0,loading:K,children:"Save MCP overrides"}),e.jsx(x,{type:"button",variant:"secondary",disabled:K,onClick:()=>M({endpoint:"",timeoutMs:"",maxRetries:""}),children:"Reset fields"})]})]})]})]}),e.jsx(pe,{}),e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"test-connection"}),e.jsx("input",{type:"hidden",name:"provider",value:t}),e.jsxs(T,{gap:"300",children:[e.jsx(x,{loading:k("test-connection")&&((re=y.formData)==null?void 0:re.get("provider"))===t,children:"Test connection"}),e.jsxs(p,{as:"p",variant:"bodySm",tone:"subdued",children:["Last ",((oe=l.history[0])==null?void 0:oe.status)??"n/a"," test at "," ",((ae=l.history[0])==null?void 0:ae.timestamp)??"n/a",(ie=l.history[0])!=null&&ie.message?` — ${(le=l.history[0])==null?void 0:le.message}`:"",J?` — ${J}`:""]})]})]})]})},t)})})})]})}),e.jsx(w.Section,{children:e.jsxs(o,{children:[e.jsx(o,{title:"Feature toggles"}),e.jsx(o,{children:e.jsxs(C,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"update-toggles"}),e.jsxs(g,{gap:"300",children:[e.jsx(f,{label:"Use mock data",name:"useMockData",checked:u.useMockData,onChange:t=>m(n=>({...n,useMockData:t})),helpText:"Enable mock data mode for development and testing."}),e.jsx(f,{label:"Enable MCP integration",name:"enableMcpIntegration",checked:u.enableMcpIntegration,onChange:t=>m(n=>({...n,enableMcpIntegration:t})),helpText:"Controls access to storefront MCP widgets."}),e.jsx(f,{label:"Enable MCP connectors",name:"enableMcp",checked:u.enableMcp,onChange:t=>m(n=>({...n,enableMcp:t})),helpText:"Enable MCP connector functionality for external integrations."}),e.jsx(f,{label:"Enable SEO features",name:"enableSeo",checked:u.enableSeo,onChange:t=>m(n=>({...n,enableSeo:t})),helpText:"Enable SEO analysis and optimization features."}),e.jsx(f,{label:"Enable inventory features",name:"enableInventory",checked:u.enableInventory,onChange:t=>m(n=>({...n,enableInventory:t})),helpText:"Enable inventory management and reorder point features."}),e.jsx(f,{label:"Enable Assistants provider",name:"enableAssistantsProvider",checked:u.enableAssistantsProvider,onChange:t=>m(n=>({...n,enableAssistantsProvider:t})),helpText:"Connects the inbox to the live Assistants service for draft approvals."}),e.jsx(f,{label:"Enable experimental widgets",name:"enableExperimentalWidgets",checked:u.enableExperimentalWidgets,onChange:t=>m(n=>({...n,enableExperimentalWidgets:t})),helpText:"Shows beta dashboard cards for internal QA."}),e.jsx(f,{label:"Enable beta workflows",name:"enableBetaWorkflows",checked:u.enableBetaWorkflows,onChange:t=>m(n=>({...n,enableBetaWorkflows:t})),helpText:"Allows merchants to opt into upcoming flows."}),(s==null?void 0:s.formErrors)&&((q=s.meta)==null?void 0:q.intent)==="update-toggles"&&e.jsx(ce,{message:s.formErrors.join(", "),fieldID:"feature-toggles"}),e.jsx(x,{primary:!0,loading:k("update-toggles"),children:"Save toggles"})]})]})})]})})]})]})}export{et as default};
