import{r as o,j as e}from"./index-DZoorY08.js";import{u as je,b as Se,c as ye,e as ee}from"./components-CTA1UUXK.js";import{P as fe}from"./PolarisVizProvider-BMFajI3Y.js";import{P as ve,b as d,C as c,I as l,T as s,d as ke,B as k,c as b,e as E,a as ne}from"./Page-CO1VPtMw.js";import{T as we}from"./TitleBar-DFMSJ8Yc.js";import{B as q}from"./Banner-DCanv2aO.js";import{D as w}from"./Divider-DdX0k3iD.js";import{I as Ce}from"./InlineGrid-Bklo_vep.js";import{L as W}from"./Layout-Drv8ZkBJ.js";import{L as Ae}from"./LineChart-DpGSaaOT.js";import{S as P}from"./Select-BzpuXWta.js";import{D as ae}from"./DataTable-DOlFJz1k.js";import"./context-CVB7tZr2.js";import"./SkipLink-CU7_6Q_C.js";import"./ChartContainer-DSIix7Zm.js";import"./LineSeries-CNDg3zjh.js";import"./index-1GQyLQny.js";import"./AfterInitialMount-C-VclerA.js";import"./Sticky-3Wxpi6V4.js";const Le={success:"success",warning:"warning",error:"critical"},Pe={not_started:"Not started",in_progress:"In progress",done:"Done"},Te={not_started:"subdued",in_progress:"info",done:"success"},De=new Intl.NumberFormat("en-US"),I=r=>De.format(Math.round(r)),se=(r,x=1)=>`${(Number.isFinite(r)?r:0).toFixed(x)}%`,Ee=r=>{const x=Number.isFinite(r)?r:0,C=x.toFixed(1);return x>0?`+${C}`:C},te=r=>new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric"}),Ie=r=>{switch(r){case"critical":return"critical";case"warning":return"warning";default:return"info"}};function Ye(){var Y,Z;const{dataset:r,scenario:x,useMockData:C,filters:t,adapters:m,keywords:M,keywordTotal:re,pages:F,pageTotal:ie,actions:N,actionTotals:O,coverageIssues:A,traffic:L,trafficSummary:B,mcp:f}=je(),[z]=Se(),Q=ye(),g=ee(),T=ee(),[R,$]=o.useState(t.keywordSearch),[_,V]=o.useState(t.pageSearch),[S,H]=o.useState(N),D=o.useCallback((n,a)=>{a&&(n.append("title",a.title),n.append("description",a.description),n.append("priority",a.priority),n.append("source",a.source),a.metricLabel&&n.append("metricLabel",a.metricLabel),a.metricValue&&n.append("metricValue",a.metricValue),a.dueAt&&n.append("dueAt",a.dueAt))},[]);o.useEffect(()=>{$(t.keywordSearch)},[t.keywordSearch]),o.useEffect(()=>{V(t.pageSearch)},[t.pageSearch]),o.useEffect(()=>{H(N)},[N]),o.useEffect(()=>{var n,a;if((n=g.data)!=null&&n.csv&&((a=g.data)!=null&&a.filename)){const i=new Blob([g.data.csv],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(i),p=document.createElement("a");p.href=u,p.download=g.data.filename,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(u)}},[g.data]);const h=o.useCallback(n=>{const a=new URLSearchParams(z);Object.entries(n).forEach(([u,p])=>{p===null||p===""?a.delete(u):a.set(u,p)});const i=a.toString();Q({search:i?`?${i}`:""},{replace:!0})},[Q,z]),le=o.useCallback((n,a)=>{h({[n]:a?"1":"0"})},[h]),oe=o.useCallback(n=>{n==null||n.preventDefault(),h({keyword:R.trim()||null})},[R,h]),de=o.useCallback(()=>{$(""),h({keyword:null})},[h]),ce=o.useCallback(n=>{n==null||n.preventDefault(),h({pageSearch:_.trim()||null})},[_,h]),ue=o.useCallback(()=>{V(""),h({pageSearch:null})},[h]),J=o.useCallback(n=>{const a=new FormData;a.append("intent",n==="keywords"?"export-keywords":"export-pages"),t.keywordSearch&&a.append("keyword",t.keywordSearch),t.keywordIntent!=="all"&&a.append("keywordIntent",t.keywordIntent),t.pageStatus!=="all"&&a.append("page",t.pageStatus),t.pageSearch&&a.append("pageSearch",t.pageSearch),t.actionPriority!=="all"&&a.append("actionPriority",t.actionPriority),a.append("ga4",t.toggles.ga4?"1":"0"),a.append("gsc",t.toggles.gsc?"1":"0"),a.append("bing",t.toggles.bing?"1":"0"),g.submit(a,{method:"post"})},[g,t]),pe=o.useCallback((n,a)=>{const i=S.find(j=>j.id===n);if(!i)return;const u=new Date().toISOString(),p={...i,status:a,lastUpdatedAt:u};H(j=>j.map(v=>v.id===n?{...v,status:a,lastUpdatedAt:u}:v));const y=new FormData;y.append("intent","update-action"),y.append("actionId",n),y.append("status",a),y.append("assignedTo",i.assignedTo??"Unassigned"),D(y,p),T.submit(y,{method:"post"})},[T,S,D]),he=o.useCallback((n,a)=>{const i=S.find(v=>v.id===n);if(!i)return;const u=new Date().toISOString(),p=a||"Unassigned",y={...i,assignedTo:p,lastUpdatedAt:u};H(v=>v.map(G=>G.id===n?{...G,assignedTo:p,lastUpdatedAt:u}:G));const j=new FormData;j.append("intent","update-action"),j.append("actionId",n),j.append("assignedTo",p),j.append("status",i.status),D(j,y),T.submit(j,{method:"post"})},[T,S,D]),ge=o.useMemo(()=>t.actionPriority!=="all"?[t.actionPriority]:["now","soon","later"],[t.actionPriority]),K=o.useMemo(()=>t.actionPriority==="all"?S:S.filter(n=>n.priority===t.actionPriority),[S,t.actionPriority]),be=o.useMemo(()=>K.reduce((n,a)=>(n[a.priority].push(a),n),{now:[],soon:[],later:[]}),[K]),xe=o.useMemo(()=>{const n=new Set;return S.forEach(a=>n.add(a.assignedTo)),n.add("Unassigned"),Array.from(n).filter(Boolean).map(a=>({label:a,value:a}))},[S]),me=o.useMemo(()=>L.length?[{name:"Clicks",data:L.map(n=>({key:n.date,value:n.clicks}))},{name:"Impressions",data:L.map(n=>({key:n.date,value:n.impressions}))}]:[],[L]),X=o.useMemo(()=>[m.ga4,m.gsc,m.bing],[m]);return e.jsx(fe,{children:e.jsxs(ve,{title:"SEO insights",subtitle:"Review health scores, keyword opportunities, and technical issues.",children:[e.jsx(we,{title:"SEO"}),e.jsxs(d,{gap:"500",children:[(r.alert||r.error||C)&&e.jsxs(d,{gap:"200",children:[C&&e.jsx(q,{tone:x==="warning"?"warning":"info",title:`Mock state: ${x}`,children:e.jsx("p",{children:"Adjust `mockState` in the query string to explore alternate UI states."})}),r.alert&&!r.error&&e.jsx(q,{tone:"warning",title:"SEO attention required",children:e.jsx("p",{children:r.alert})}),r.error&&e.jsx(q,{tone:"critical",title:"SEO signals unavailable",children:e.jsx("p",{children:r.error})})]}),e.jsxs(c,{children:[e.jsx(c,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"Data sources"}),e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:"Toggle adapters for this view. Connection health reflects the latest Settings sync."})]}),e.jsx(ke,{children:X.map(n=>e.jsx(k,{pressed:n.toggled&&!n.disabledByConnection,disabled:n.disabledByConnection,onClick:()=>le(n.id,!(n.toggled&&!n.disabledByConnection)),children:n.label},n.id))})]})}),e.jsx(w,{borderColor:"border"}),e.jsx(c,{children:e.jsx(Ce,{columns:{xs:1,sm:3},gap:"200",children:X.map(n=>e.jsxs(d,{gap:"100",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{variant:"bodySm",as:"span",children:n.label}),e.jsx(b,{tone:Le[n.status],children:n.status==="success"?"Healthy":n.status==="warning"?"Warning":"Error"})]}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:n.disabledByConnection?"Enable in Settings to hydrate this section.":n.error??n.message??"Connected"})]},n.id))})})]}),e.jsxs(W,{children:[e.jsx(W.Section,{children:e.jsx(c,{title:"Scorecard",children:e.jsxs(d,{gap:"200",children:[e.jsx(U,{label:"Core Web Vitals",value:`${r.scorecard.coreWebVitals}%`}),e.jsx(U,{label:"Click-through rate",value:`${r.scorecard.clickThroughRate}%`}),e.jsx(U,{label:"Crawl success",value:`${r.scorecard.crawlSuccessRate}%`}),e.jsx(U,{label:"Keyword rankings",value:`${r.scorecard.keywordRankings}%`})]})})}),e.jsx(W.Section,{children:e.jsxs(c,{children:[e.jsx(c,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"Organic traffic"}),e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:r.range.label})]}),B&&e.jsxs(l,{gap:"200",children:[e.jsxs(d,{gap:"030",children:[e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:"Sessions"}),e.jsx(s,{variant:"headingSm",as:"span",children:I(B.sessions)})]}),e.jsxs(d,{gap:"030",children:[e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:"Conversions"}),e.jsx(s,{variant:"headingSm",as:"span",children:I(B.conversions)})]})]})]})}),e.jsx(c,{children:m.ga4.active&&L.length?e.jsx("div",{style:{width:"100%",height:260},children:e.jsx(Ae,{isAnimated:!1,data:me,xAxisOptions:{labelFormatter:n=>te(String(n))},tooltipOptions:{keyFormatter:n=>te(String(n)),valueFormatter:(n,{series:a})=>a===0?`${I(Number(n??0))} clicks`:`${I(Number(n??0))} impressions`}})}):e.jsx(s,{variant:"bodySm",tone:"subdued",children:m.ga4.toggled?"GA4 data unavailable. Check adapter status in settings.":"GA4 adapter disabled for this view."})})]})})]}),e.jsxs(c,{children:[e.jsx(c,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"Keyword performance"}),e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"span",children:[M.length," of ",re," queries shown"]})]}),e.jsxs(l,{gap:"200",children:[e.jsx(P,{label:"Keyword intent",labelHidden:!0,options:[{label:"All intents",value:"all"},{label:"Transactional",value:"transactional"},{label:"Informational",value:"informational"},{label:"Navigational",value:"navigational"}],value:t.keywordIntent,onChange:n=>h({keywordIntent:n==="all"?null:n})}),e.jsx(k,{onClick:()=>J("keywords"),loading:g.state!=="idle"&&((Y=g.formData)==null?void 0:Y.get("intent"))==="export-keywords",children:"Export CSV"})]})]})}),e.jsx(w,{borderColor:"border"}),e.jsx(c,{children:e.jsx("form",{onSubmit:oe,children:e.jsxs(l,{gap:"200",blockAlign:"end",wrap:!0,children:[e.jsx(E,{minWidth:"240px",children:e.jsx(ne,{label:"Search keywords",labelHidden:!0,placeholder:"Filter keywords or top pages",value:R,onChange:n=>$(n)})}),e.jsxs(l,{gap:"100",children:[e.jsx(k,{submit:!0,children:"Apply"}),e.jsx(k,{onClick:de,variant:"secondary",children:"Clear"})]})]})})}),e.jsx(c,{children:m.gsc.active&&M.length?e.jsx(ae,{columnContentTypes:["text","numeric","numeric","numeric","numeric","numeric","text","text"],headings:["Keyword","Clicks","Impressions","CTR","Avg position","Δ position","Intent","Top page"],rows:M.map(n=>[n.query,n.clicks.toLocaleString("en-US"),n.impressions.toLocaleString("en-US"),se(n.ctr,2),n.avgPosition.toFixed(1),Ee(n.delta),n.intent.replace(/^(.)/,a=>a.toUpperCase()),n.topPage??"—"])}):e.jsx(s,{variant:"bodySm",tone:"subdued",children:m.gsc.toggled?"Search Console data unavailable. Check adapter status in settings.":"Search Console adapter disabled for this view."})})]}),e.jsxs(c,{children:[e.jsx(c,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"Landing pages"}),e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"span",children:[F.length," of ",ie," tracked pages"]})]}),e.jsxs(l,{gap:"200",children:[e.jsx(P,{label:"Canonical status",labelHidden:!0,options:[{label:"All",value:"all"},{label:"Issue",value:"issue"},{label:"Healthy",value:"ok"}],value:t.pageStatus,onChange:n=>h({page:n==="all"?null:n})}),e.jsx(k,{onClick:()=>J("pages"),loading:g.state!=="idle"&&((Z=g.formData)==null?void 0:Z.get("intent"))==="export-pages",children:"Export CSV"})]})]})}),e.jsx(w,{borderColor:"border"}),e.jsx(c,{children:e.jsx("form",{onSubmit:ce,children:e.jsxs(l,{gap:"200",blockAlign:"end",wrap:!0,children:[e.jsx(E,{minWidth:"240px",children:e.jsx(ne,{label:"Search pages",labelHidden:!0,placeholder:"Filter by URL or title",value:_,onChange:n=>V(n)})}),e.jsxs(l,{gap:"100",children:[e.jsx(k,{submit:!0,children:"Apply"}),e.jsx(k,{onClick:ue,variant:"secondary",children:"Clear"})]})]})})}),A.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{borderColor:"border-subdued"}),e.jsxs(c,{subdued:!0,children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{variant:"headingSm",as:"h3",children:"Coverage warnings"}),e.jsxs(b,{tone:A.length>2?"critical":"warning",children:[A.length," open"]})]}),e.jsxs(d,{gap:"050",children:[A.slice(0,3).map(n=>e.jsxs(s,{variant:"bodySm",children:[n.issue," — ",n.page]},`${n.page}-${n.issue}`)),A.length>3&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["+",A.length-3," additional issues in Search Console"]})]})]})]}),e.jsx(w,{borderColor:"border"}),e.jsx(c,{children:m.bing.active&&F.length?e.jsx(ae,{columnContentTypes:["text","numeric","numeric","numeric","text"],headings:["Page","Entrances","Exits","Conversion","Canonical"],rows:F.map(n=>[`${n.title} — ${n.url}`,n.entrances.toLocaleString("en-US"),n.exits.toLocaleString("en-US"),se(n.conversionRate,2),n.canonicalStatus==="issue"?`Issue — ${n.canonicalIssue??"Review canonical"}`:"Healthy"])}):e.jsx(s,{variant:"bodySm",tone:"subdued",children:m.bing.toggled?"Bing metrics unavailable. Add credentials in settings.":"Bing adapter disabled for this view."})})]}),e.jsxs(c,{children:[e.jsx(c,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"Action queue"}),e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:"Prioritized follow-ups grouped by severity"})]}),e.jsxs(l,{gap:"200",blockAlign:"center",children:[e.jsx(P,{label:"Action priority",labelHidden:!0,options:[{label:"All priorities",value:"all"},{label:"Now",value:"now"},{label:"Soon",value:"soon"},{label:"Later",value:"later"}],value:t.actionPriority,onChange:n=>h({actionPriority:n==="all"?null:n})}),e.jsxs(l,{gap:"100",blockAlign:"center",children:[e.jsxs(b,{tone:"critical",children:["Now ",O.now]}),e.jsxs(b,{tone:"warning",children:["Soon ",O.soon]}),e.jsxs(b,{tone:"info",children:["Later ",O.later]})]})]})]})}),e.jsx(w,{borderColor:"border"}),e.jsxs(c,{children:[ge.map(n=>{const a=be[n];return a.length?e.jsxs(d,{gap:"200",children:[e.jsx(s,{variant:"headingSm",as:"h3",children:n==="now"?"Now":n==="soon"?"Soon":"Later"}),e.jsx(d,{gap:"200",children:a.map(i=>e.jsxs(E,{padding:"200",background:"bg-surface-secondary",borderRadius:"200",children:[e.jsx(d,{gap:"150",children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"headingSm",as:"h4",children:i.title}),e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:i.description})]}),e.jsx(b,{tone:Te[i.status],children:Pe[i.status]})]})}),e.jsx(w,{borderColor:"border-subdued"}),e.jsxs(l,{gap:"200",wrap:!0,blockAlign:"center",children:[e.jsx(P,{label:"Status",labelHidden:!0,options:[{label:"Not started",value:"not_started"},{label:"In progress",value:"in_progress"},{label:"Done",value:"done"}],value:i.status,onChange:u=>pe(i.id,u)}),e.jsx(P,{label:"Owner",labelHidden:!0,options:xe,value:i.assignedTo,onChange:u=>he(i.id,u)}),e.jsxs(b,{tone:"info",children:[i.metricLabel,": ",i.metricValue]}),i.dueAt&&e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"span",children:["Due ",new Date(i.dueAt).toLocaleDateString()]})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"span",children:["Updated ",new Date(i.lastUpdatedAt).toLocaleDateString()]})]},i.id))})]},n):t.actionPriority!=="all"?e.jsx(s,{variant:"bodySm",tone:"subdued",children:"No actions in this bucket."},n):null}),!K.length&&e.jsx(s,{variant:"bodySm",tone:"subdued",children:"No SEO actions match the selected filters."})]})]}),e.jsx(c,{title:"MCP keyword opportunities",children:e.jsxs(d,{gap:"200",children:[f.opportunities.map(n=>e.jsx(E,{background:"bg-subdued",padding:"200",borderRadius:"200",children:e.jsxs(d,{gap:"150",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"050",children:[e.jsx(s,{variant:"bodyMd",as:"span",children:n.handle}),e.jsx(s,{variant:"bodySm",tone:"subdued",as:"span",children:n.notes??"Prioritize optimization to unlock incremental traffic."})]}),e.jsxs(b,{tone:"info",children:["Impact +",n.projectedImpact.toFixed(1),"%"]})]}),n.keywordCluster.length>0&&e.jsx(l,{gap:"150",wrap:!0,children:n.keywordCluster.map(a=>e.jsx(b,{tone:"subdued",children:a},a))})]})},n.handle)),f.opportunities.length===0&&e.jsx(s,{variant:"bodySm",tone:"subdued",as:"p",children:f.enabled?"No MCP SEO opportunities available yet. Check again after the next crawl.":"Enable the MCP integration in Settings to populate keyword opportunities."}),f.generatedAt&&e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"p",children:["Last updated ",new Date(f.generatedAt).toLocaleString()," • ",f.source??"mock"]}),f.usingMocks&&e.jsx(s,{variant:"bodySm",tone:"subdued",as:"p",children:"Showing mock MCP data while `USE_MOCK_DATA` is enabled."})]})}),e.jsx(c,{title:"Insights",children:e.jsxs(d,{gap:"300",children:[r.insights.map(n=>e.jsxs(d,{gap:"150",children:[e.jsxs(l,{align:"space-between",blockAlign:"start",children:[e.jsxs(l,{gap:"100",blockAlign:"center",children:[e.jsx(b,{tone:Ie(n.severity),children:n.severity}),e.jsx(s,{variant:"headingSm",as:"h3",children:n.title})]}),e.jsxs(s,{as:"span",variant:"bodySm",tone:"subdued",children:[n.source.toUpperCase()," • ",new Date(n.detectedAt).toLocaleDateString()]})]}),e.jsx(s,{variant:"bodyMd",as:"p",children:n.description}),e.jsxs(l,{gap:"200",children:[e.jsxs(b,{tone:"info",children:[n.metricLabel,": ",n.metricValue]}),n.delta&&e.jsxs(s,{variant:"bodySm",tone:"subdued",as:"span",children:["Δ ",n.delta]}),n.url&&e.jsx("a",{href:n.url,target:"_blank",rel:"noreferrer",children:"View page"})]})]},n.id)),!r.insights.length&&e.jsx(s,{variant:"bodySm",tone:"subdued",as:"p",children:"No active insights. Connect GA4/GSC/Bing in Settings to populate this view."})]})})]})]})})}function U({label:r,value:x}){return e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:r}),e.jsx(s,{as:"span",variant:"headingMd",children:x})]})}export{Ye as default};
