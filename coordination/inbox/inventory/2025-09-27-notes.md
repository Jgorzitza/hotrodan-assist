# 2025-09-27 Inventory Planner UI Notes

## Updates
- Added vitest coverage for `app/routes/app.inventory.tsx` loader/actions (`app/routes/__tests__/app.inventory.test.ts`) covering bucket selection, MCP overrides, CSV export, and draft saves.
- `npm exec vitest run app/routes/__tests__/app.inventory.test.ts --config vitest.config.ts` (run from `dashboard/`) passes â€” expected Vite WS port warning plus payload validation log from the invalid JSON test.
- Moved trend rollup logic into `app/lib/inventory/math.ts` and sanitized sparkline datasets in the planner UI so the detail modal + table consume the same helper once analytics goes live.
- `npx vitest run app/lib/__tests__/inventory-math.test.ts` (from `dashboard/`) now covers stockout date fallbacks, reorder math, and the new trend stats helper.
- Added `aggregateTrendSeries` to combine bucket SKU trends and surface an aggregated sparkline + WoW badges in `/app.inventory`; `BucketTrendSummary` blocks now share the same math for quick reference.
- `npm exec vitest run app/lib/__tests__/inventory-math.test.ts` (from `dashboard/`) passes after the new aggregation cases.

## Next
- Stay ready to swap mock analytics for live feeds once the Shopify data contract lands; keep MCP wiring mocked until overrides are confirmed in settings repo.
- Coordinate with data-layer agent on ingest format so the new trend stats helper can accept real analytics payloads without reshaping.
- Follow up with data-layer once the inventory analytics endpoint is ready so the bucket-level aggregate sparkline can hydrate from live data instead of mocks.
