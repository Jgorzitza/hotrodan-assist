# 2025-10-08 Data Agent Notes

## Updates
- Prisma CLI seed hook now runs via `node --import ./prisma/register-ts-loader.mjs prisma/seed.ts` (drops the Node experimental loader warning). `prisma.config.ts` still guards on the loader + register shim existing; please update any data docs referencing the old `--loader` invocation.
- Updated `prompts/dashboard/database.md` so the seeding guidance now calls out the `node --import ./prisma/register-ts-loader.mjs prisma/seed.ts` command.
- Re-ran `npm run prisma:generate`, SQLite `db push`, seed, and the retention Vitest suite to confirm Prisma + cron scaffolding stay green (WebSocket warning expected in sandbox).
- Implemented `fetchSalesAnalyticsWithCache` to persist analytics datasets in `KpiCache`; Remix sales loader/action now use the cached fetch path and new Vitest coverage (`app/lib/sales/__tests__/cache.server.test.ts`, `app/routes/__tests__/app.sales.test.ts`) passed alongside `npm exec vitest run â€¦` (expected Vite WebSocket warning only).

## Next
- Hold for Ops decision on Fly vs Render before wiring `/cron/retention` in staging; rerun retention tests once the staging deploy picks up the latest migrations.
- Coordinate with Sales/UI once the analytics service contract is live to validate the Prisma cache hit path and document the refresh/invalidation flow.
