<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Draft {{ draft.id }}</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; max-width: 960px; }
      .meta { margin-bottom: 1rem; }
      pre { white-space: pre-wrap; background: #f7f7f7; padding: 1rem; border: 1px solid #ddd; }
      form { margin-top: 1rem; }
      label { display: block; margin-top: 0.5rem; }
      textarea { width: 100%; min-height: 160px; }
      a { color: #2a5db0; }
      .sources ul { margin: 0; padding-left: 1.2rem; }
      .banner { padding: 0.75rem 1rem; border-radius: 4px; margin-bottom: 1rem; }
      .banner--warning { background: #fff4ce; border: 1px solid #f29900; color: #5c3b00; }
    </style>
  </head>
  <body>
    <p><a href="/">‚Üê Back to queue</a></p>
    {% if not sse_online %}
    <div class="banner banner--warning">
      Live event stream is currently offline. Actions will still complete, but
      new updates will require a page refresh.
    </div>
    {% endif %}
    <h1>Draft {{ draft.id }}</h1>
    <div class="meta">
      <strong>Status:</strong> {{ draft.status }}<br>
      <strong>Channel:</strong> {{ draft.channel }}<br>
      <strong>Conversation:</strong> {{ draft.conversation_id }}<br>
      <strong>Created:</strong> {{ draft.created_at }}
    </div>

    <h2>Incoming Message</h2>
    <pre>{{ draft.incoming_text }}</pre>

    <h2>Suggested Reply</h2>
    <pre>{{ draft.suggested_text }}</pre>

    <div class="sources">
      <h3>Sources</h3>
      <ul>
        {% for src in draft.sources %}
        <li><a href="{{ src }}" target="_blank" rel="noopener">{{ src }}</a></li>
        {% else %}
        <li>No sources returned</li>
        {% endfor %}
      </ul>
    </div>

    <section>
      <h2>Approve</h2>
      <form action="/drafts/{{ draft.id }}/approve" method="post">
        <label>Approver User ID
          <input type="text" name="approver_user_id" required>
        </label>
        <button type="submit">Approve and Send</button>
      </form>
    </section>

    <section>
      <h2>Edit</h2>
      <form action="/drafts/{{ draft.id }}/edit" method="post">
        <label>Editor User ID
          <input type="text" name="editor_user_id" required>
        </label>
        <label>Final Text
          <textarea name="final_text" required>{{ draft.final_text or draft.suggested_text }}</textarea>
        </label>
        <button type="submit">Save Edit &amp; Send</button>
      </form>
    </section>
  </body>
</html>
